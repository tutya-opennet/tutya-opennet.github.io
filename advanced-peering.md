---
sitemap: true
tags: dontlink
---

# همتاسازی‌های پیشرفته(Advanced Peerings)
این سند شامل اطلاعاتی درباره راه‌اندازی‌های همتاسازی(peering) پیشرفته‌تر است. 
### همتاسازی‌های خروجی چندمسیره(Multi-homed outbound peerings)
روی ماشینی که چندین رابط شبکه(network interfaces) دارد، جایی که بیش از یک رابط می‌تواند برای رسیدن به یک همتا(peer) (یا اینترنت(Internet)) استفاده شود، گزینه `InterfacePeers` می‌تواند به‌جای گزینه `Peers` برای ایجاد همتاسازی‌ها روی رابط‌های مشخص استفاده شود.

امکان اتصال به **همان همتا چندین بار** با استفاده از رابط‌های مختلف وجود دارد، که یک پیکربندی همتاسازی با دسترس‌پذیری بالا(highly-available) ایجاد می‌کند:

```
InterfacePeers: {
	"eth0": [
		tls://a.b.c.d:e
	]
	"eth1": [
		tls://a.b.c.d:e
	]
}
```

### شنونده‌های اولویت‌دار(Prioritised listeners)
مانند مثال چندمسیره بالا، ماشین ممکن است دو یا چند رابط شبکه داشته باشد. یک مثال می‌تواند رابط Wi-Fi و رابط اترنت سیمی(wired ethernet) باشد. اگر می‌خواهید اتصال‌های همتاسازی ورودی(incoming peering connections) را روی هر دو بپذیرید، اما به‌طور مشخص ترجیح دهید هر زمان ممکن ترافیک(traffic) روی یکی از لینک‌ها ارسال شود، می‌توانید از فیلد `priority` در URI همتاسازی(peering URI) استفاده کنید.

اعداد کمتر بهتر هستند. در این مثال، آدرس IP `a.b.c.d` متعلق به آداپتور اترنت سیمی است و آدرس IP `f.g.h.i` متعلق به آداپتور Wi-Fi است. همتاسازی‌ها به درگاه(port) همتاسازی با اولویت 1 هر زمان ممکن استفاده می‌شوند، بنابراین اگر گره دیگری به هر دو رابط همتا شود، همتاسازی سیمی نسبت به همتاسازی بی‌سیم ترجیح داده می‌شود:

```
tls://a.b.c.d:e?priority=1
tls://f.g.h.i:e?priority=2
```

توجه کنید فیلد `priority` فقط ترافیک بین دو همتاسازی به همان گره را تحت تأثیر قرار می‌دهد. این فیلد روی تصمیم‌های مسیریابی(routing decisions) در میان گره‌های مختلف اثر ندارد و نمی‌توان از آن برای اجتناب از ارسال ترافیک به یک همتای راه‌دور(remote peer) به جای دیگری استفاده کرد.

### رابط‌های چندپخشی اولویت‌دار(Prioritised multicast interfaces)
اگر مانند بالا چندین رابط شبکه دارید اما از همتاهای چندپخشی(multicast peers) استفاده می‌کنید و می‌خواهید یک رابط شبکه را نسبت به دیگری ترجیح دهید، می‌توانید `Priority` را برای یک رابط چندپخشی مشخص کنید.

اعداد کمتر بهتر هستند. در این مثال، همتاسازی‌هایی که به‌طور خودکار روی `eth0` کشف و برقرار می‌شوند، نسبت به همتاسازی‌هایی که روی `eth1` به همان گره ساخته می‌شوند ترجیح داده خواهند شد:

```
MulticastInterfaces: [
	{
		Regex: eth0
		Beacon: true
		Listen: true
		Priority: 1
	}, 
	{
		Regex: eth1
		Beacon: true
		Listen: true
		Priority: 2
	}
]
```

توجه کنید فیلد `priority` فقط ترافیک بین دو همتاسازی به همان گره را تحت تأثیر قرار می‌دهد. این فیلد روی تصمیم‌های مسیریابی در میان گره‌های مختلف اثر ندارد و نمی‌توان از آن برای اجتناب از ارسال ترافیک به یک همتای راه‌دور به جای دیگری استفاده کرد.

### مدارهای Tor خروجی چندگانه(Multiple outbound Tor circuits)
همتاسازی روی Tor با استفاده از پشتیبانی پروکسی SOCKS امکان‌پذیر است، هرچند معمولاً توصیه نمی‌شود چون همتاسازی‌های Tor اغلب کند و شکننده هستند. مهم‌تر اینکه، مدارهای Tor می‌توانند هر زمان شکسته شوند و در نتیجه اتصال همتاسازی tutya-opennet شما نیز قطع می‌شود.

برای کاهش این مشکل، گزینه `IsolateSOCKSAuth` را در Tor فعال کنید و سپس با استفاده از نام‌های کاربری و گذرواژه‌های SOCKS متفاوت، **چندین اتصال به همان همتا** برقرار کنید. نام‌های کاربری و گذرواژه‌ها می‌توانند هر چیزی باشند، اما این جفت‌های یکتا باعث می‌شوند Tor برای هر اتصال همتاسازی یک مدار جداگانه استفاده کند و در برابر خراب شدن یکی از آن مدارها افزونگی(redundancy) ایجاد شود:

```
Peers: [
	socks://one:one@localhost:9050/a.b.c.d:e
	socks://two:two@localhost:9050/a.b.c.d:e
	socks://three:three@localhost:9050/a.b.c.d:e
]
```

برای اطلاعات بیشتر، راهنمای Tor برای `IsolateSOCKSAuth` را ببینید. 

### همتاسازی‌های چندپخشی در ترکیب با فایروال میزبان(Multicast peerings in combination with a host firewall)
اگر دستگاه شما فایروال(firewall) فعال دارد، کشف همتاها از طریق `MulticastInterfaces` ممکن است به‌طور پیش‌فرض کار نکند. برای اینکه این کار انجام شود، سه مرحله زیر را انجام دهید:

1. زیر `MulticastInterfaces`، مقدار `Port` را روی یک شماره درگاه TCP ثابت قرار دهید؛
2. اتصال TCP ورودی به این شماره درگاه انتخاب‌شده را از طریق فایروال خود مجاز کنید — این اجازه اتصال‌های همتاسازی ورودی از دستگاه‌های دیگر را می‌دهد؛
3. اتصال UDP ورودی روی درگاه 9001 (به‌صورت اختیاری با آدرس مقصد `ff02::114`) را از طریق فایروال خود مجاز کنید — این به دستگاه شما اجازه می‌دهد بیکن‌های چندپخشی(multicast beacons) دستگاه‌های دیگر را بشنود.