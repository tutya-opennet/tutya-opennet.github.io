---
sitemap: true
tags: dontlink
---

# پیکربندی(Configuration)

tutya-opennet می‌تواند در یکی از دو حالت اجرا شود: با یک فایل پیکربندی(configuration file)، یا در حالت پیکربندی خودکار(autoconfigure mode).

یک فایل پیکربندی ایستا(static configuration file) بیشتر راه‌اندازی‌ها را ساده می‌کند زیرا به شما اجازه می‌دهد همان جفت‌کلید(keypair) (و بنابراین آدرس IP) را نگه دارید، فهرستی از همتاها(peers) را حفظ کنید و غیره. برای بیشتر کاربران این پیکربندی توصیه می‌شود. بیشتر بسته‌های توزیع(distribution packages) tutya-opennet به‌طور خودکار یک فایل پیکربندی `yggdrasil.conf` ایجاد می‌کنند، هرچند احتمالاً قبل از قابل استفاده شدن tutya-opennet باید خودتان همتاها(peers) را به فایل پیکربندی اضافه کنید. بخش «اتصال دستی به همتاها(Manually Connecting to Peers)» را در پایین ببینید.

با این حال، حالت پیکربندی خودکار(autoconfigure mode) به شما اجازه می‌دهد tutya-opennet را با تنظیمات پیش‌فرض(default settings) نسبتاً منطقی سریع راه‌اندازی کنید، با `yggdrasil -autoconf`. در این حالت، tutya-opennet به‌طور خودکار تلاش می‌کند با گره‌های دیگر در همان زیرشبکه(subnet) همتا شود اما **به‌طور پیش‌فرض تلاش نمی‌کند به همتاهای عمومی(public peers) متصل شود**. همچنین هر بار که شروع می‌شود یک مجموعه کلید تصادفی(random set of keys) تولید می‌کند و بنابراین هر بار یک آدرس IP تصادفی خواهد داشت.

tutya-opennet از پیکربندی در قالب HJSON یا JSON پشتیبانی می‌کند. HJSON قالب پیش‌فرض ترجیحی است چون کامنت(comment) دارد، هرچند پشتیبانی از JSON هم به‌دلیل سهولت دست‌کاری(manipulation) در دسترس است.

### مرجع پیکربندی(Configuration reference)

اطلاعات درباره گزینه‌های مختلف در فایل پیکربندی [در اینجا](configurationref.md) قابل دسترسی است.

### تولید یک فایل پیکربندی جدید(Generating a new config file)

اگر tutya-opennet را از طریق یکی از بسته‌های سکویی(platform packages) نصب کرده‌اید (مثلاً macOS، Debian، RPM)، ممکن است یک فایل پیکربندی پیش‌فرض(default configuration file) از قبل وجود داشته باشد.

این فایل احتمالاً در یکی از مسیرهای `/etc/yggdrasil.conf` یا `/etc/yggdrasil/yggdrasil.conf` قرار دارد، بسته به سکو(platform) شما.

در غیر این صورت، می‌توانید یک فایل پیکربندی را به روش‌های زیر تولید کنید:

| **تولید HJSON(Generate HJSON)**: | `yggdrasil -genconf > /etc/yggdrasil.conf` |
| **تولید JSON(Generate JSON)**: | `yggdrasil -genconf -json > /etc/yggdrasil.conf` |

### استفاده از یک فایل پیکربندی(Using a config file)

tutya-opennet می‌تواند یک فایل پیکربندی را یا از طریق `stdin` بپذیرد یا با دادن مسیر(path) فایل در فایل‌سیستم(filesystem):

| **استفاده از stdin(Using stdin)**: | `yggdrasil -useconf < /etc/yggdrasil.conf` |
| **استفاده از فایل(Using file)**: | `yggdrasil -useconffile /etc/yggdrasil.conf` |

### یکدست‌سازی یک فایل پیکربندی(Normalising a config file)

اگر می‌خواهید قالب اصلی فایل پیکربندی را ببینید یا بین قالب‌های HJSON و JSON تبدیل انجام دهید، می‌توانید از گزینه `-normaliseconf` استفاده کنید، مثلاً:

| **تبدیل از HJSON به JSON(Convert from HJSON to JSON)**: | `yggdrasil -normaliseconf -useconffile /etc/yggdrasil.conf -json` |
| **تبدیل از JSON به HJSON(Convert from JSON to HJSON)**: | `yggdrasil -normaliseconf -useconffile /etc/yggdrasil.conf` |

یکدست‌سازی(Normalising) پیکربندی همچنین هر مورد پیکربندیِ جاافتاده را با مقدار پیش‌فرض(default values) اضافه می‌کند. این می‌تواند هنگام ارتقا به نسخه جدیدتر tutya-opennet که گزینه‌های پیکربندی جدید اضافه می‌کند مفید باشد. بسیاری از بسته‌های توزیع ما هنگام ارتقا، پیکربندی را به‌طور خودکار یکدست می‌کنند.

### صادر کردن کلیدها به فایل‌های خارجی(Exporting keys to external files)

می‌توانید کلید خصوصی(private key) را از یک فایل پیکربندی موجود به یک فایل جداگانه صادر(export) کنید:

| **صادر کردن کلید خصوصی(Export private key)**: | `yggdrasil -useconffile /etc/yggdrasil.conf -exportkey > yggdrasil.key` |

پس از صادر کردن، می‌توانید خط `PrivateKey` را از فایل پیکربندی خود حذف کنید و به‌جای آن یک ورودی `PrivateKeyPath` اضافه کنید که به فایل کلید صادرشده اشاره می‌کند.

### اتصال دستی به همتاها(Manually Connecting to Peers)

tutya-opennet می‌تواند با افزودن ورودی‌ها به بخش پیکربندی `Peers` به همتاهای دیگر متصل شود. در زمان راه‌اندازی(startup)، tutya-opennet تلاش می‌کند یک اتصال(connection) به این همتاها باز کند.

یک URI همتاسازی(peering URI) مشابه یکی از موارد زیر خواهد بود:

| **اتصال مستقیم TCP(Direct TCP connection)**: | `tcp://hostname:port` |
| **اتصال مستقیم TCP+TLS(Direct TCP+TLS connection)**: | `tls://hostname:port` |
| **اتصال مستقیم QUIC(Direct QUIC connection)**: | `quic://hostname:port` |
| **از طریق پروکسی SOCKS(Via a SOCKS proxy)**: | `socks://proxyhostname:proxyport/hostname:port` |

به‌طور پیش‌فرض، فقط همتاسازی خودکار محلیِ پیوند(link-local auto-peering) فعال است. این حالت دستگاه‌هایی را که به‌طور مستقیم در لایه 2 به هم متصل هستند، شامل دستگاه‌های روی یک LAN، اتصال مستقیم با اترنت(ethernet) یا پیکربندی برای استفاده از همان شبکه بی‌سیم موردی(ad-hoc wireless network) به هم متصل می‌کند.

چون شبکه از TCP معمولی استفاده می‌کند، امکان اتصال از طریق شبکه‌های دیگر مانند اینترنت یا لینک‌های WAN وجود دارد، به شرطی که گره در حال اتصال آدرس و درگاه(port) اتصال را بداند و اتصال توسط NAT یا فایروال(firewall) مسدود نشده باشد. اگر گره پشت NAT باشد، ممکن است نیاز به پورت‌فورواردینگ(port forwarding) برای پذیرش اتصال‌های ورودی باشد.

اگر نتوانید در منطقه نزدیک گرهی پیدا کنید، یک تلاش با «بهترین کوشش(best effort)» برای نگه‌داری فهرست [همتاهای عمومی(Public Peers)](https://github.com/yggdrasil-network/public-peers) برای کاربران جدیدی که می‌خواهند به شبکه بپیوندند یا آن را آزمایش کنند انجام می‌شود.

### اعلان یک پیشوند(Advertising a Prefix)

اگرچه معمولاً توصیه می‌شود گره‌ها نرم‌افزار را به‌طور محلی اجرا کنند تا نشست‌های رمزنگاری‌شده انتها-به-انتها(end-to-end cryptographic sessions) فراهم شود و در مسیریابی(routing) مشارکت کنند، همیشه این کار عملی نیست. ممکن است دستگاه منابع کافی برای اجرای نرم‌افزار نداشته باشد یا نتواند کد کاربر(user code) اجرا کند. برای همین، tutya-opennet علاوه بر آدرس IPv6 هر گره، یک زیرشبکه(subnet) مسیریابی‌شده `/64` هم ارائه می‌کند. گره‌ای که tutya-opennet را اجرا می‌کند و نقش مسیریاب(router) دارد می‌تواند این پیشوند(prefix) را به دستگاه‌های دیگر اعلان کند، درست مانند هر شبکه IPv6 معمولی.

این موضوع با مثال بهتر روشن می‌شود.
فرض کنید یک گره آدرس `200:1111:2222:3333:4444:5555:6666:7777` را تولید کرده است.
در این صورت گره می‌تواند از آدرس‌های پیشوند `300:1111:2222:3333::/64` هم استفاده کند (توجه کنید `200` به `300` تغییر کرده است، یک `/8` جداگانه برای پیشوندها استفاده می‌شود، اما باقی 64 بیت نخست یکسان هستند).

می‌توانید زیرشبکه مسیریابی‌شده خود را با اجرای `yggdrasilctl getSelf` و پیدا کردن `IPv6 subnet` پیدا کنید. این مقدار همچنین هنگام راه‌اندازی tutya-opennet ثبت(logged) می‌شود.

در Linux، چیزی مشابه موارد زیر باید برای اعلان یک پیشوند و یک مسیر(route) به `200::/7` با استفاده از radvd به یک شبکه متصل به رابط(interface) `eth0` کافی باشد:

1. فعال‌سازی ارسال IPv6(IPv6 forwarding) (مثلاً `sysctl -w net.ipv6.conf.all.forwarding=1` یا افزودن آن به `sysctl.conf`)
2. `ip addr add 300:1111:2222:3333::1/64 dev eth0` یا مشابه — با جایگزینی `300:1111:2222:3333::` با زیرشبکه مسیریابی‌شده شما از `yggdrasilctl getSelf` — تا یک آدرس برای مسیریاب در آن پیشوند اختصاص دهد، جایی که LAN از طریق `eth0` قابل دسترسی است
3. نصب/اجرای `radvd` با چیزی مشابه موارد زیر در `/etc/radvd.conf` — باز هم با جایگزینی `300:1111:2222:3333::` با زیرشبکه مسیریابی‌شده شما:

```
interface eth0
{
	AdvSendAdvert on;
	prefix 300:1111:2222:3333::/64 {
		AdvOnLink on;
		AdvAutonomous on;
	};
	route 200::/7 {};
};
```

توجه کنید که یک پیشوند `/64` بیت‌های کمتری از فضای آدرس برای بررسی در برابر شناسه گره(node's ID) دارد، که به معنی احتمال بیشتر برخوردِ هش(hash collisions) است. بنابراین، اتکا به آدرس‌ها به‌عنوان شکلی از تأیید هویت(identity verification) برای بازه آدرس `300::/8` کار عاقلانه‌ای نیست.

### تولید آدرس‌های قوی‌تر(Generating Stronger Addresses) (و پیشوندها(Prefixes))

در حالی که 128 بیت به اندازه کافی بلند است که برخوردها از نظر فنی غیرعملی یا حتی غیرممکن باشند، نامعقول نیست فکر کنیم که 64 بیت ممکن است در آینده قابل حمله باشد، اگر نه اکنون.
بدون ورود زیاد به جزئیات، آدرس‌ها یک هش(hash) کوتاه‌شده از کلید عمومی(public key) گره هستند، با بیت‌های پیشرو `1` که تجمع(accumulated) یافته و سرکوب(suppressed) می‌شوند (همراه با بیت `0` اولیه اجتناب‌ناپذیر).
به لطف تجمع‌کننده(accumulator)، امکان تولید کلیدها به‌صورت brute force وجود دارد تا بیت‌های بیشتری از شناسه گره در آدرس IPv6 گره قرار گیرد، و در نتیجه برخوردها دشوارتر شوند.
این کار تا حدی این واقعیت را جبران می‌کند که آدرس‌های IPv6 فقط 128 بیت هستند، و مهم‌تر اینکه پیشوندها فقط 64 بیت هستند که 16 بیت آن به پیشوند `200::/7` و 1 بایت به تجمع‌کننده اختصاص داده می‌شود.

خلاصه اینکه، اگر قصد دارید یک پیشوند اعلان کنید، یا اگر می‌خواهید آدرس شما به‌طور استثنایی سخت برای برخورد(collide) باشد، قویاً توصیه می‌شود مقداری چرخه CPU بسوزانید تا یک مجموعه کلید سخت‌تر برای برخورد تولید کنید، با استفاده از ابزار زیر:

```
go run ./cmd/genkeys
```

این ابزار به‌طور پیوسته کلیدهای جدید تولید می‌کند و هر بار که یک مجموعه کلید بهتر(new best set of keys) کشف شود آن‌ها را چاپ می‌کند.
سپس این کلیدها می‌توانند به‌صورت دستی در فایل پیکربندی اضافه شوند.