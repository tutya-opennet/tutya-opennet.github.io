---
sitemap: true
tags: dontlink
---

# پیاده‌سازی(Implementation)

شبکه عمومی tutya-opennet یک شبکه هم‌پوشان آزمایشی(testbed overlay network) است که پروتکل مسیریابی tutya-opennet را اجرا می‌کند.

تمام گره‌های شبکه(network nodes) مسیریاب‌های نرم‌افزاری(userspace software routers) هستند که در یک فرایند(process) واحد اجرا می‌شوند. مسیریاب به‌صورت اختیاری یک آداپتور TUN مجازی(virtual TUN adapter) را برای سیستم‌عامل میزبان(host operating system) فراهم می‌کند که امکان ارسال و دریافت ترافیک IPv6 روی شبکه tutya-opennet را می‌دهد. اتصال‌های همتاسازی(peering connections) بین این گره‌ها روی شبکه‌های محلی(local area networks)، لینک‌های نقطه-به-نقطه(point-to-point) یا اینترنت(Internet) عمدتاً با استفاده از اتصال‌های TCP/TLS برقرار می‌شوند. تعدادی [همتای عمومی(Public Peers)](https://publicpeers.neilalexander.dev) وجود دارد که می‌توان از آن‌ها برای پیوستن به شبکه عمومی استفاده کرد.

پیاده‌سازی tutya-opennet به‌عنوان یک شبکه هم‌پوشان(overlay network) به ما اجازه می‌دهد پروتکل و طرح مسیریابی(routing scheme) را در مقیاس(scale) نسبتاً آسان آزمایش کنیم، زیرا مسیریاب کاربر-فضا(user-space router) می‌تواند به‌راحتی روی بیشتر رایانه‌ها اجرا شود. کاربران همچنین برای پیوستن یا آزمایش شبکه نیازی ندارند که از نظر فیزیکی به یکدیگر نزدیک باشند. کاربران می‌توانند فقط نرم‌افزار را دانلود کنند و چند همتاسازی روی اینترنت یا شبکه‌های دیگر برقرار کنند. با این حال، طراحی tutya-opennet آن را محدود به پیاده‌سازی صرفاً به‌عنوان شبکه هم‌پوشان نمی‌کند — همچنین می‌تواند به‌صورت یک پروتکل مسیریابی بومی(native routing protocol) با لینک‌های فیزیکی پیاده‌سازی شود.

### tutya-opennet چگونه امن می‌شود؟

برای اطمینان از اینکه ترافیک هنگام مسیریابی از میان گره‌های دیگر شبکه خصوصی(private) باقی می‌ماند، تمام ترافیک در همه زمان‌ها به‌صورت انتها-به-انتها(end-to-end) رمزگذاری می‌شود. حتی ترافیک برنامه کاربردیِ متن‌واضح(plain-text application traffic) با استفاده از کلید عمومی(public key) گره مقصد رمزگذاری می‌شود تا اطمینان حاصل شود گره‌های میانی(intermediate nodes) نمی‌توانند محتوای ترافیکی را که از شبکه عبور می‌کند شنود(snoop) کنند.

هر کسی می‌تواند به شبکه عمومی tutya-opennet بپیوندد و بنابراین باید آن را یک شبکه غیرقابل اعتماد(untrusted network) در نظر گرفت، مشابه یک شبکه وای‌فای عمومی(public Wi-Fi) یا یک اتصال مستقیم اینترنت. برای جلوگیری از اینکه سرویس‌های روی ماشین شما به‌طور تصادفی در معرض همه کاربران شبکه tutya-opennet قرار گیرند، استفاده از یک فایروال دارای قابلیت IPv6 که ترافیک ورودی غیرمنتظره را مسدود کند قویاً توصیه می‌شود.

### گره‌ها چگونه با یکدیگر همتا می‌شوند؟

گره‌های شبکه همتاسازی‌ها را به یکی از دو روش زیر برقرار می‌کنند:

1. به‌صورت دستی توسط کاربر. هر گره می‌تواند طوری پیکربندی شود که اتصال‌های همتاسازی ورودی را بپذیرد و می‌تواند به گره‌های شنونده(listening nodes) دیگر اتصال‌های خروجی برقرار کند. به این‌ها «همتاسازی‌های ایستا(static peerings)» گفته می‌شود زیرا در فایل پیکربندی وجود دارند و معمولاً در زمان اجرا(runtime) تغییر نمی‌کنند.
2. کشف چندپخشی محلیِ پیوند(link-local multicast discovery). گره‌ها می‌توانند به‌صورت اختیاری حضور خود را در شبکه محلی به گره‌های شنونده دیگر اعلان(advertise) کنند، که سپس تلاش می‌کنند همتاسازی‌ها را به‌صورت خودکار برقرار کنند. در بیشتر موارد، این کار به هر دو گره‌ای که با یک لینک IP به هم متصل هستند اجازه می‌دهد به‌صورت خودکار یکدیگر را کشف کنند و یک اتصال همتاسازی را به‌صورت «plug and play» ایجاد کنند.

نکته مهم این است که گره‌های tutya-opennet **هرگز** همتاسازی‌های جدید را به‌صورت خودکار با گره‌های راه‌دور(remote) (یعنی غیر کشف‌شده با چندپخشی) برقرار نمی‌کنند. tutya-opennet عمداً هیچ مفهومی از تبادل همتا(peer exchange) ندارد، همان‌طور که اغلب در دیگر طراحی‌های هم‌پوشان(overlay) و DHT دیده می‌شود، و در حال حاضر برنامه‌ای برای افزودن آن نداریم.

دلیل این موضوع این است که هدف پروتکل tutya-opennet یافتن بهترین مسیرهای ممکن با استفاده از مجموعه لینک‌هایی است که از قبل در دسترس هستند. بنابراین ضروری است که هیچ فرضی درباره توپولوژی زیرین شبکه(topology) در زیر همتاسازی‌ها نکنیم، و همچنین فرض نکنیم که هر دو گره بتوانند در صورت نیاز یک لینک مستقیم برقرار کنند. در شبکه‌های دنیای واقعی با لینک‌های فیزیکی، برقراری خودکار لینک‌های همتاسازی جدید بین جفت‌های دلخواه گره‌ها به‌سادگی ممکن نخواهد بود.

### گره‌ها چگونه شناسایی می‌شوند؟

در طراحی tutya-opennet، هویت واقعی یک گره کلید عمومی(public key) آن است. پیاده‌سازی هم‌پوشان فعلی یک آدرس IPv6 بر اساس کلید عمومی کوتاه‌شده(truncated public key) تولید می‌کند. ترجمه بین آدرس‌های IPv6 و کلیدهای عمومی جزئی(partial public keys)، و همچنین جست‌وجوی شبکه بر اساس آن کلیدها، به‌صورت شفاف(transparent) توسط مسیریاب tutya-opennet انجام می‌شود؛ بنابراین تنها چیزی که برای برقراری ارتباط با یک گره راه‌دور نیاز دارید آدرس IPv6 تولیدشده توسط آن گره است.

سامانه نام دامنه(Domain Name System (DNS)) و دیگر سازوکارهای جست‌وجوی نام/سرویس(name/service lookup) به‌طور مشخص خارج از دامنه پروژه(out of scope) هستند و هیچ سامانه DNS «رسمی» برای استفاده روی شبکه tutya-opennet تأیید نشده است، هرچند برخی پروژه‌های ثالث(third-party) که تلاش می‌کنند این مشکل را حل کنند واقعاً وجود دارند.

### چه مشکلاتی امروز وجود دارد؟

اینترنت با یک توپولوژی(topology) دقیقاً تعریف‌شده همخوانی ندارد. این موضوع عمدتاً در گذر زمان رخ داده است — با رشد اینترنت، شبکه‌های بیشتری با ترتیبات همتاسازی بین ارائه‌دهندگان خدمات به هم «پیچ و مهره شده‌اند(bolted together)». این موضوع برای ما برخی مشکلات اجتناب‌ناپذیر ایجاد می‌کند:

1. جدول‌های مسیریابی(routing tables) که «نقشه» اینترنت را نگه می‌دارند بسیار بزرگ و ناکارآمد هستند، زیرا هر ارائه‌دهنده باید اطلاعات مربوط به پیشوندهای IP متعلق به همه ارائه‌دهندگان دیگر را رله(relay) کند
1. واقعاً راهی وجود ندارد که یک رایانه بداند نسبت به چیزهای دیگر روی اینترنت در کجا قرار دارد — بیشتر ماشین‌ها فقط از یک «درگاه پیش‌فرض(default gateway)» آگاه‌اند
1. بررسی اینکه یک بسته(packet) در مسیر خود از مبدأ(source) به مقصد(destination) کجا خواهد رفت بدون ارسال واقعی آن دشوار است

این مشکلات تا حدی (اما نه واقعاً) از طریق مرکزیت(centralisation) کاهش یافته‌اند. به‌جای اینکه رایانه‌های خانگی شما یک نسخه از جدول مسیریابی جهانی(global routing table) را نگه دارند، ارائه‌دهنده خدمات شما این کار را به‌جای شما انجام می‌دهد. رایانه‌ها و دستگاه‌های شبکه شما فقط طوری پیکربندی شده‌اند که «ترافیک را به بالا‌دست(send traffic upstream)» بفرستند و ارائه‌دهنده تصمیم بگیرد از آن‌جا به بعد به کجا برود.

شبکه‌های ISP نیز معمولاً در طراحی ساخت‌یافته(structured) و غالباً سلسله‌مراتبی(hierarchical) هستند، و در نتیجه بسیاری از پروتکل‌های مسیریابی موجود با این موضوع در ذهن طراحی شده‌اند. برخی بهینه‌سازی‌ها مانند تجمیع پیشوند(prefix aggregation) برای کاهش تعداد ورودی‌های مسیریابی که یک ارائه‌دهنده باید به جهان ارسال کند استفاده می‌شوند. این پروتکل‌ها معمولاً برای استفاده در شبکه‌ای که توپولوژی آن دقیقاً تعریف نشده یا به‌طور مکرر تغییر می‌کند مناسب نیستند — برای مثال، یک شبکه مش بی‌سیم(wireless mesh network) — بنابراین در گذشته ساخت زیرساخت مش بی‌سیم به‌صورت موردی(ad-hoc) برای جوامع بسیار دشوار بوده است.

### tutya-opennet چه کار متفاوتی انجام می‌دهد؟

tutya-opennet رویکرد کاملاً متفاوتی برای به‌اشتراک‌گذاری دانش مسیریابی(routing knowledge) دارد. به‌جای توزیع بازه‌های آدرس به‌صورت مسیرهایی از طریق سامانه‌های خودمختار(autonomous systems) اختصاص‌داده‌شده مرکزی، tutya-opennet در عوض یک توپولوژی شبکه جهانی توزیع‌شده(distributed global network topology) واحد می‌سازد.

یک درخت گسترده(spanning tree) برای همگام‌سازی(synchronisation) استفاده می‌شود و به گره‌ها اجازه می‌دهد مجموعه‌ای از مختصات درخت(tree coordinates) را به خود اختصاص دهند که برای تبادل و برقراری پیام‌های بوت‌استرپ(bootstrap) و راه‌اندازی مسیر(path setup) استفاده می‌شوند. سپس گره‌ها فیلترهای بلوم(bloom filters) را تبادل می‌کنند که اطلاعاتی درباره اینکه کدام همسایه‌های فضای کلید(keyspace neighbours) از طریق هر گره قابل دسترسی هستند در خود دارد. گره‌های میانی(intermediate nodes) سپس جدول‌های مسیریابی خود را با این مسیرها پر می‌کنند و به گره‌ها امکان می‌دهند بسته‌ها را به سمت کلید عمومی مقصد خود نزدیک‌تر ارسال کنند.

علاوه بر این، گره‌ها می‌توانند با استفاده از مسیریابی درخت گسترده(spanning tree routing) مسیر‌یابی(pathfind) کنند تا مسیری ایجاد کنند که احتمالاً کوتاه‌تر از مسیر از طریق فضای کلید است. مسیر مبدأ(source route) معمولاً مستقیم‌تر تا زمانی که در دسترس باشد استفاده می‌شود و اگر مسیر مسیریابی‌شده با درخت(tree-routed path) قطع شود، به مسیریابی فضای کلید(keyspace routing) بازمی‌گردد.

امضاهای رمزنگاری‌شده(cryptographic signatures) برای امن‌سازی پیام‌های پروتکل در برابر دستکاری(tampering) یا جعل(forgery) استفاده می‌شوند.

### مزایا چیست؟

چندین مزیت برای چنین طرح مسیریابی وجود دارد:

1. دستگاه‌ها فقط نیاز دارند مقدار نسبتاً کمی وضعیت(state) را برای کار کردن و ارسال بسته‌ها نگه دارند — هیچ نیازی نیست که هیچ گره tutya-opennet جدول‌های مسیریابی «کامل(full routing tables)» مانند BGP را نگه دارد، و بیشتر گره‌ها در مجموع فقط تعداد کمی ورودی جدول مسیریابی دارند
1. مسیرها به‌صورت خودکار در شبکه کشف و ساخته می‌شوند، بنابراین پیکربندی دستی ورودی‌های مسیریابی لازم نیست — تنها پیکربندی موردنیاز اتصال‌های همتاسازی بین خودِ گره‌ها است
1. شبکه می‌تواند مسیرها را سریع برقرار و جمع کند بدون اینکه همه وضعیت مسیریابی را دور بریزد، که به‌طور قابل‌توجهی در مدیریت رویدادهای تحرک گره(node mobility events) بدون از دست دادن بسته‌ها (اگر هم از دست برود) کمک می‌کند
1. می‌توانیم شبکه‌های قابل‌اعتماد/ایستا(reliable/static networks) را بسیار آسان با شبکه‌های پویا/غیرایستا(dynamic/non-static networks) پل‌سازی(bridge) کنیم بدون نیاز به سیلابی کردن حجم زیادی از وضعیت
1. شبکه‌ها زمانی که هر دو یا چند گره tutya-opennet به یکدیگر متصل شوند، به‌صورت خودکار شکل می‌گیرند، حتی اگر آن اتصال‌ها کاملاً موردی(ad-hoc) باشند، که امکان ساخت شبکه‌های مش بی‌سیم واقعی(true wireless mesh networks) را فراهم می‌کند
1. دانش مسیریابی پراکنده(sparse routing knowledge) و فقط مقدار کمی ترافیک پروتکل(protocol traffic) باید به این معنا باشد که tutya-opennet بتواند به‌طور کارآمد به شبکه‌های بسیار بزرگ مقیاس‌پذیر شود

### آیا tutya-opennet معیارهای لینک(link metrics) دارد؟

به‌عنوان یک طراحی پروتکل مسیریابی غیرمتمرکز(decentralised routing protocol design)، ما معتقدیم تصمیم‌های مسیریابی فقط باید با استفاده از اطلاعاتی انجام شوند که هر گره بتواند به‌صورت امن و مستقل با هزینه کم(low-cost fashion) آن‌ها را تأیید کند. بنابراین بیشتر معیارهای تعاملی کیفیت لینک(interactive link quality metrics) را در این زمان خارج از دامنه(out-of-scope) می‌دانیم، هرچند احتمالاً با بالغ‌تر شدن پروتکل در آینده تغییر خواهد کرد.

ما آگاهیم که این موضوع، در کنار توانایی ایجاد همتاسازی‌ها روی اینترنت به‌صورت آزاد و آسان، به این معناست که همتاسازی‌های غیربهینه(suboptimal peerings) احتمالاً در شبکه آزمایشی عمومی tutya-opennet ظاهر می‌شوند.

ازدحام شبکه(network congestion) در هر گره به‌صورت خودکار با شکلی از صف‌بندی عادلانه بسته‌ها(fair packet queuing) مدیریت می‌شود. این کار تلاش می‌کند جریان‌های ترافیک را بین گره‌های مختلف در حد امکان به‌طور برابر متوازن کند، و همچنین تضمین می‌کند که گره‌های منفرد نتوانند تمام پهنای باند لینک موجود(available link bandwidth) را روی یک همتاسازی یا مجموعه‌ای از همتاسازی‌ها اشباع(saturate) کنند. این موضوع همچنین کمک می‌کند تا تأخیر کلی شبکه(network latency) در حد امکان پایین بماند.